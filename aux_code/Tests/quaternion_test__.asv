%% testing quaternion and angular velocity related issues
clear all
close all
clc
w=[2; 3; 5]*pi/180; %% angular velocity
q0 = [1;0;0;0];
W = w2omega(w);
dt= 1;
q1 = q0 + 0.5*dt*W*q0; %% aproximate
q1 = q1/norm(q1); %% normalize
q2 = qProd(q0,v2q(w*dt)); %% accurate
q2 = q2/norm(q2); %% normalize
q2e(q1)*180/pi 
q2e(q2)*180/pi
[a1,u1] = q2au(q1); %% convert to axis angle
dt1 = 2;
q3 = [cos(a1*dt1/2); sin(a1*dt1/2)*u1]
q2e(q3)*180/pi;


%%%%%% 
qprod__ = qprod(q2qc(q0),q1);
qprod__ = qprod__./norm(qprod__);

w__ = 2*log(qprod__);
% For unit length quaternions this evaluates to
w_calc = (2*w__(2:4) / norm(w__(2:4)))*acos(w__(1));
W_calc = w2omega(w_calc');
q4 = q0 + 0.5*dt*W_calc'*q0;
q4= q4./norm(q4)
q2e(q4)*180/pi 

q2R(q4)*q2R(q1)



